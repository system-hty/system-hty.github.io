<!DOCTYPE html>
<html lang="zh" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S币系统 - SYSTEM-HTY</title>
    <meta name="description" content="SYSTEM-HTY的S币积分系统，奖励用户活跃和贡献">
    <meta name="keywords" content="S币,积分系统,奖励,SYSTEM-HTY">
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" crossorigin>
    <link rel="preload" href="images/2.webp" as="image">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* 使用与index.html完全相同的CSS变量和基础样式 */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --text-color: #333;
            --text-light: #7f8c8d;
            --card-bg: rgba(255, 255, 255, 0.92);
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            --transition: all 0.3s ease;
            --nav-bg: rgba(255, 255, 255, 0.95);
            --border-color: #ddd;
            --scoin-color: #9c27b0;
            --gold-color: #ffd700;
            --silver-color: #c0c0c0;
            --bronze-color: #cd7f32;
        }

        [data-theme="dark"] {
            --text-color: #e0e0e0;
            --text-light: #a0a0a0;
            --light-color: #121212;
            --card-bg: #1e1e1e;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            --primary-color: #64b5f6;
            --secondary-color: #81c784;
            --accent-color: #ff8a65;
            --dark-color: #f5f5f5;
            --nav-bg: rgba(30, 30, 30, 0.95);
            --border-color: #444;
            --scoin-color: #ba68c8;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            scroll-behavior: smooth;
            background-color: var(--light-color);
            line-height: 1.6;
        }

        /* 骨架屏加载效果 */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--light-color);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--card-bg);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader.hidden {
            animation: fadeOut 0.5s forwards;
            pointer-events: none;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--nav-bg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: var(--shadow);
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 4px;
        }

        .brand-logo img {
            height: 100%;
            width: auto;
            object-fit: contain;
            transition: var(--transition);
        }

        .brand-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark-color);
            transition: var(--transition);
        }

        .top-nav:hover .brand-logo {
            transform: scale(1.05);
        }

        .top-nav:hover .brand-name {
            color: var(--primary-color);
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .nav-link {
            padding: 8px 15px;
            background-color: var(--nav-bg);
            color: var(--dark-color) !important;
            border-radius: 4px;
            text-decoration: none;
            transition: var(--transition);
            font-weight: bold;
            border: 1px solid var(--border-color);
        }

        .nav-link:hover {
            background-color: var(--primary-color);
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .nav-link.active {
            background-color: var(--primary-color);
            color: white !important;
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            color: var(--dark-color);
            font-weight: bold;
        }

        .scoin-mini {
            display: inline-flex;
            align-items: center;
            background-color: var(--scoin-color);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .scoin-mini i {
            margin-right: 5px;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--dark-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            text-decoration: underline;
            color: var(--accent-color);
        }

        .container {
            max-width: 1200px;
            margin: 100px auto 40px;
            padding: 20px;
        }

        .section {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        h1, h2, h3 {
            color: var(--dark-color);
            margin-top: 0;
        }

        h2 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        p, li {
            line-height: 1.6;
            color: var(--text-color);
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        a:hover {
            text-decoration: underline;
            color: var(--secondary-color);
        }

        .scoin-section {
            margin: 30px 0;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 8px;
            border-left: 4px solid var(--scoin-color);
            box-shadow: var(--shadow);
        }

        .scoin-balance {
            font-size: 1.5rem;
            text-align: center;
            margin: 20px 0;
        }

        .scoin-count {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--scoin-color);
        }

        .scoin-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-scoin {
            background-color: var(--scoin-color);
            color: white;
        }

        .btn-scoin:hover {
            background-color: #7b1fa2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-scoin:disabled {
            background-color: #b39ddb;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .scoin-info {
            text-align: center;
            margin-top: 15px;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .admin-badge {
            display: inline-block;
            background-color: #ffd700;
            color: #333;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }

        footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-light);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 100;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: rotate(45deg);
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid var(--scoin-color);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notification.show {
            opacity: 1;
        }

        .notification-icon {
            color: var(--scoin-color);
            font-size: 1.5rem;
        }

        /* ===== S币系统特有样式 ===== */
        .scoin-hero {
            text-align: center;
            padding: 50px 20px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, var(--scoin-color) 0%, var(--primary-color) 100%);
            border-radius: 15px;
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .scoin-hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--gold-color), var(--silver-color), var(--bronze-color));
        }

        .scoin-title {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .scoin-subtitle {
            font-size: 1.3rem;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0.9;
        }

        .scoin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--scoin-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--scoin-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--text-color);
            font-size: 1rem;
        }

        .earn-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .method-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .method-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: var(--scoin-color);
        }

        .method-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .method-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .method-reward {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--scoin-color);
        }

        .method-desc {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .method-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-available {
            background: var(--secondary-color);
            color: white;
        }

        .status-completed {
            background: var(--text-light);
            color: white;
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .transaction-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .transaction-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .transaction-type {
            font-weight: bold;
            color: var(--dark-color);
        }

        .transaction-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .amount-positive {
            color: var(--secondary-color);
        }

        .amount-negative {
            color: var(--accent-color);
        }

        .leaderboard {
            margin: 30px 0;
        }

        .leaderboard-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .rank-1 {
            background: var(--gold-color);
            color: #333;
        }

        .rank-2 {
            background: var(--silver-color);
            color: #333;
        }

        .rank-3 {
            background: var(--bronze-color);
            color: white;
        }

        .leaderboard-user {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .leaderboard-name {
            font-weight: bold;
            color: var(--dark-color);
        }

        .leaderboard-score {
            font-weight: bold;
            color: var(--scoin-color);
            font-size: 1.1rem;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .reward-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid var(--border-color);
        }

        .reward-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--scoin-color);
        }

        .reward-icon {
            font-size: 2.5rem;
            color: var(--scoin-color);
            margin-bottom: 20px;
        }

        .reward-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .reward-cost {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--scoin-color);
            margin-bottom: 15px;
        }

        .reward-desc {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        /* 移动设备适配 */
        @media (max-width: 768px) {
            .top-nav {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .brand {
                flex-direction: row;
                align-items: center;
            }
            
            .brand-logo {
                height: 35px;
            }
            
            .brand-name {
                font-size: 1.2rem;
            }
            
            .nav-links {
                flex-wrap: wrap;
            }
            
            .container {
                margin: 120px 10px 40px;
                padding: 15px;
            }
            
            .scoin-actions {
                flex-direction: column;
                align-items: center;
            }

            .scoin-title {
                font-size: 2.2rem;
            }

            .scoin-subtitle {
                font-size: 1.1rem;
            }

            .earn-methods {
                grid-template-columns: 1fr;
            }

            .scoin-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .rewards-grid {
                grid-template-columns: 1fr;
            }
            
            .theme-toggle {
                top: 80px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <p>加载中...</p>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-coins notification-icon"></i>
        <span id="notificationText"></span>
    </div>
    
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </div>
    
    <div class="top-nav">
        <div class="brand">
            <div class="brand-logo">
                <img src="images/2.webp" alt="SYSTEM-HTY标志" 
                     onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzQ5OGRiIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+U1lTVEVNLUhUWTwvdGV4dD48L3N2Zz4='">
            </div>
            <div class="brand-name">SYSTEM-HTY</div>
        </div>
        
        <div class="nav-links">
            <a href="index.html" class="nav-link">
                <i class="fas fa-home"></i> 主页
            </a>
            <a href="download.html" class="nav-link">
                <i class="fas fa-download"></i> 下载
            </a>
            <a href="bbs.html" class="nav-link">
                <i class="fas fa-comments"></i> BBS论坛
            </a>
            <a href="about.html" class="nav-link">
                <i class="fas fa-info-circle"></i> 关于
            </a>
            <a href="scoin-system.html" class="nav-link active">
                <i class="fas fa-coins"></i> S币系统
            </a>
            <a href="donate.html" class="nav-link">
                <i class="fas fa-donate"></i> 捐献支持
            </a>
        </div>
        
        <div id="authButtons">
            <a href="login.html" class="nav-link">
                <i class="fas fa-sign-in-alt"></i> 登录
            </a>
            <a href="login.html" class="nav-link">
                <i class="fas fa-user-plus"></i> 注册
            </a>
        </div>
        
        <div id="userStatus" class="user-status" style="display: none;">
            <div class="user-avatar" id="userAvatar"></div>
            <span class="user-name" id="userName">游客</span>
            <span class="scoin-mini">
                <i class="fas fa-coins"></i> <span id="scoinCount">0</span>
            </span>
            <a href="PersonalHomepage.html" class="nav-link" title="个人主页">
                <i class="fas fa-home"></i>
            </a>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> 退出
            </button>
        </div>
    </div>
    
    <div class="container">
        <div class="scoin-hero">
            <h1 class="scoin-title">S币系统</h1>
            <p class="scoin-subtitle">赚取S币，兑换专属奖励，支持开发者持续创作</p>
        </div>
        
        <div class="scoin-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-number" id="userBalance">0</div>
                <div class="stat-label">我的S币</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-ranking-star"></i>
                </div>
                <div class="stat-number" id="userRank">-</div>
                <div class="stat-label">我的排名</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-number" id="loginStreak">0</div>
                <div class="stat-label">连续登录</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-number" id="totalEarned">0</div>
                <div class="stat-label">累计获得</div>
            </div>
        </div>
        
        <div class="section">
            <h2>我的S币</h2>
            <div class="scoin-balance">
                当前余额: <span class="scoin-count" id="scoinBalance">0</span> S币
                <span id="adminBadge" class="admin-badge" style="display: none;">
                    <i class="fas fa-crown"></i> 站长
                </span>
            </div>
            
            <div class="scoin-actions">
                <button class="btn btn-scoin" id="claimDailyBtn">
                    <i class="fas fa-gift"></i> 领取每日S币
                </button>
                <button class="btn btn-primary" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> 刷新数据
                </button>
            </div>
            
            <div class="scoin-info" id="scoinInfo">
                每日登录可领取S币，连续登录有额外奖励！
            </div>
        </div>
        
        <div class="section">
            <h2>赚取S币</h2>
            <p>通过以下方式赚取更多S币：</p>
            
            <div class="earn-methods">
                <div class="method-card">
                    <div class="method-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <h3 class="method-name">每日登录</h3>
                    <div class="method-reward">+5 S币</div>
                    <p class="method-desc">每天首次登录即可领取S币奖励</p>
                    <span class="method-status status-available" id="dailyStatus">可领取</span>
                </div>
                
                <div class="method-card">
                    <div class="method-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <h3 class="method-name">连续登录</h3>
                    <div class="method-reward">+10 S币</div>
                    <p class="method-desc">连续登录7天可获得额外奖励</p>
                    <span class="method-status status-completed" id="streakStatus">进行中</span>
                </div>
                
                <div class="method-card">
                    <div class="method-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <h3 class="method-name">下载软件</h3>
                    <div class="method-reward">+15 S币</div>
                    <p class="method-desc">下载并使用我们的软件工具</p>
                    <span class="method-status status-available">可完成</span>
                </div>
                
                <div class="method-card">
                    <div class="method-icon">
                        <i class="fas fa-comment"></i>
                    </div>
                    <h3 class="method-name">论坛活跃</h3>
                    <div class="method-reward">+20 S币</div>
                    <p class="method-desc">在论坛发帖或回复获得奖励</p>
                    <span class="method-status status-available">可完成</span>
                </div>
                
                <div class="method-card">
                    <div class="method-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <h3 class="method-name">反馈BUG</h3>
                    <div class="method-reward">+25 S币</div>
                    <p class="method-desc">提交有效的BUG报告</p>
                    <span class="method-status status-available">可完成</span>
                </div>
                
                <div class="method-card">
                    <div class="method-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3 class="method-name">捐献支持</h3>
                    <div class="method-reward">1元 = 2 S币</div>
                    <p class="method-desc">支持开发者获得S币奖励</p>
                    <span class="method-status status-available">可完成</span>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>交易记录</h2>
            <div class="transactions-list" id="transactionsList">
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-type">系统加载中...</div>
                        <div class="transaction-date">请稍候</div>
                    </div>
                    <div class="transaction-amount amount-positive">0 S币</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>排行榜</h2>
            <div class="leaderboard">
                <div class="leaderboard-list" id="leaderboardList">
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">1</div>
                        <div class="leaderboard-user">
                            <div class="leaderboard-avatar">S</div>
                            <div class="leaderboard-name">系统加载中...</div>
                        </div>
                        <div class="leaderboard-score">0 S币</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>奖励兑换</h2>
            <p>使用S币兑换专属奖励：</p>
            
            <div class="rewards-grid">
                <div class="reward-card">
                    <div class="reward-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3 class="reward-title">专属称号</h3>
                    <div class="reward-cost">100 S币</div>
                    <p class="reward-desc">获得"高级会员"专属称号，在论坛和个人主页显示</p>
                    <button class="btn btn-primary" disabled>
                        <i class="fas fa-shopping-cart"></i> 兑换
                    </button>
                </div>
                
                <div class="reward-card">
                    <div class="reward-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h3 class="reward-title">主题皮肤</h3>
                    <div class="reward-cost">200 S币</div>
                    <p class="reward-desc">解锁专属主题皮肤，个性化你的浏览体验</p>
                    <button class="btn btn-primary" disabled>
                        <i class="fas fa-shopping-cart"></i> 兑换
                    </button>
                </div>
                
                <div class="reward-card">
                    <div class="reward-icon">
                        <i class="fas fa-earlybird"></i>
                    </div>
                    <h3 class="reward-title">桌宠装扮</h3>
                    <div class="reward-cost">150 S币</div>
                    <p class="reward-desc">为你的桌宠购买新的装扮和特效</p>
                    <button class="btn btn-primary" disabled>
                        <i class="fas fa-shopping-cart"></i> 兑换
                    </button>
                </div>
                
                <div class="reward-card">
                    <div class="reward-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <h3 class="reward-title">优先下载</h3>
                    <div class="reward-cost">50 S币</div>
                    <p class="reward-desc">提前体验新版本软件和功能</p>
                    <button class="btn btn-primary" disabled>
                        <i class="fas fa-shopping-cart"></i> 兑换
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023-2025 SYSTEM-HTY. 保留所有权利。</p>
            <p>最后更新: 2023-10-15 | 加载时间: <span id="loadTime"></span> 毫秒</p>
        </footer>
    </div>

    <script>
        // 初始化Supabase客户端
        const supabaseUrl = 'https://uwzdneeawtgjlnyxjtcm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3emRuZWVhd3RnamxueXhqdGNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxOTc0MTcsImV4cCI6MjA3NTc3MzQxN30._yK9wpqT6Y8a_rzYeDloKvSbjaoIn_AFatgSlT-HqvI';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // S币系统管理
        const ScoinSystem = {
            currentUser: null,
            userData: null,
            
            async init() {
                await this.checkAuthState();
                await this.loadUserData();
                await this.loadTransactions();
                await this.loadLeaderboard();
                this.bindEvents();
            },
            
            async checkAuthState() {
                const { data: { user }, error } = await supabase.auth.getUser();
                
                if (error) {
                    console.error('获取用户信息失败:', error);
                    this.showNotification('获取用户信息失败', true);
                    return;
                }
                
                if (user) {
                    this.currentUser = {
                        id: user.id,
                        email: user.email,
                        username: user.email.split('@')[0],
                        isAdmin: user.email === '644043561@qq.com'
                    };
                    this.updateUI();
                } else {
                    this.currentUser = null;
                    this.updateUI();
                    this.showNotification('请先登录以使用S币系统');
                }
                
                // 监听认证状态变化
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        this.currentUser = {
                            id: session.user.id,
                            email: session.user.email,
                            username: session.user.email.split('@')[0],
                            isAdmin: session.user.email === '644043561@qq.com'
                        };
                        this.updateUI();
                        this.loadUserData();
                        this.showNotification('登录成功！');
                    } else if (event === 'SIGNED_OUT') {
                        this.currentUser = null;
                        this.userData = null;
                        this.updateUI();
                        this.showNotification('已退出登录');
                    }
                });
            },
            
            async loadUserData() {
                if (!this.currentUser) return;
                
                try {
                    // 获取用户S币数据
                    const { data, error } = await supabase
                        .from('user_scoin')
                        .select('*')
                        .eq('user_id', this.currentUser.id)
                        .single();
                    
                    if (error && error.code !== 'PGRST116') { // PGRST116 表示没有找到记录
                        throw error;
                    }
                    
                    if (!data) {
                        // 创建新用户记录
                        await this.createUserRecord();
                    } else {
                        this.userData = data;
                        this.updateScoinDisplay();
                    }
                } catch (error) {
                    console.error('加载用户数据失败:', error);
                    this.showNotification('加载用户数据失败', true);
                }
            },
            
            async createUserRecord() {
                if (!this.currentUser) return;
                
                try {
                    const { data, error } = await supabase
                        .from('user_scoin')
                        .insert([
                            {
                                user_id: this.currentUser.id,
                                username: this.currentUser.username,
                                balance: this.currentUser.isAdmin ? 100 : 0,
                                total_earned: 0,
                                login_streak: 0,
                                last_login_date: null,
                                last_daily_claim: null
                            }
                        ])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    this.userData = data;
                    this.updateScoinDisplay();
                    this.showNotification('S币账户已创建！');
                } catch (error) {
                    console.error('创建用户记录失败:', error);
                    this.showNotification('创建用户记录失败', true);
                }
            },
            
            async claimDailyScoin() {
                if (!this.currentUser || !this.userData) {
                    this.showNotification('请先登录', true);
                    return;
                }
                
                const today = new Date().toISOString().split('T')[0];
                
                // 检查今天是否已经领取
                if (this.userData.last_daily_claim === today) {
                    this.showNotification('今天已经领取过每日S币了！', true);
                    return;
                }
                
                try {
                    // 计算连续登录
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    
                    let newLoginStreak = 1;
                    let dailyReward = 5; // 基础奖励
                    
                    if (this.userData.last_login_date === yesterdayStr) {
                        newLoginStreak = this.userData.login_streak + 1;
                    }
                    
                    // 连续登录奖励
                    if (newLoginStreak >= 7) {
                        dailyReward += 10; // 连续7天额外奖励
                    }
                    
                    // 更新用户数据
                    const { data, error } = await supabase
                        .from('user_scoin')
                        .update({
                            balance: this.userData.balance + dailyReward,
                            total_earned: this.userData.total_earned + dailyReward,
                            login_streak: newLoginStreak,
                            last_login_date: today,
                            last_daily_claim: today,
                            updated_at: new Date().toISOString()
                        })
                        .eq('user_id', this.currentUser.id)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    this.userData = data;
                    this.updateScoinDisplay();
                    
                    // 记录交易
                    await this.recordTransaction('daily_reward', dailyReward, `每日登录奖励 (连续${newLoginStreak}天)`);
                    
                    this.showNotification(`成功领取 ${dailyReward} S币！连续登录 ${newLoginStreak} 天`);
                    
                } catch (error) {
                    console.error('领取每日S币失败:', error);
                    this.showNotification('领取失败，请重试', true);
                }
            },
            
            async recordTransaction(type, amount, description) {
                if (!this.currentUser) return;
                
                try {
                    await supabase
                        .from('scoin_transactions')
                        .insert([
                            {
                                user_id: this.currentUser.id,
                                username: this.currentUser.username,
                                type: type,
                                amount: amount,
                                description: description,
                                balance_after: this.userData.balance
                            }
                        ]);
                } catch (error) {
                    console.error('记录交易失败:', error);
                }
            },
            
            async loadTransactions() {
                if (!this.currentUser) return;
                
                try {
                    const { data, error } = await supabase
                        .from('scoin_transactions')
                        .select('*')
                        .eq('user_id', this.currentUser.id)
                        .order('created_at', { ascending: false })
                        .limit(20);
                    
                    if (error) throw error;
                    
                    this.updateTransactionsDisplay(data || []);
                } catch (error) {
                    console.error('加载交易记录失败:', error);
                    this.updateTransactionsDisplay([]);
                }
            },
            
            async loadLeaderboard() {
                try {
                    const { data, error } = await supabase
                        .from('user_scoin')
                        .select('username, balance')
                        .order('balance', { ascending: false })
                        .limit(10);
                    
                    if (error) throw error;
                    
                    this.updateLeaderboardDisplay(data || []);
                } catch (error) {
                    console.error('加载排行榜失败:', error);
                    this.updateLeaderboardDisplay([]);
                }
            },
            
            updateUI() {
                const authButtons = document.getElementById('authButtons');
                const userStatus = document.getElementById('userStatus');
                const userName = document.getElementById('userName');
                const userAvatar = document.getElementById('userAvatar');
                const adminBadge = document.getElementById('adminBadge');
                
                if (this.currentUser) {
                    authButtons.style.display = 'none';
                    userStatus.style.display = 'flex';
                    userName.textContent = this.currentUser.username;
                    
                    const initial = this.currentUser.username.charAt(0).toUpperCase();
                    userAvatar.textContent = initial;
                    userAvatar.style.backgroundColor = this.getAvatarColor(this.currentUser.username);
                    
                    if (this.currentUser.isAdmin) {
                        adminBadge.style.display = 'inline-block';
                    } else {
                        adminBadge.style.display = 'none';
                    }
                } else {
                    authButtons.style.display = 'flex';
                    userStatus.style.display = 'none';
                    adminBadge.style.display = 'none';
                }
            },
            
            updateScoinDisplay() {
                if (!this.userData) return;
                
                document.getElementById('scoinBalance').textContent = this.userData.balance;
                document.getElementById('scoinCount').textContent = this.userData.balance;
                document.getElementById('userBalance').textContent = this.userData.balance;
                document.getElementById('loginStreak').textContent = this.userData.login_streak;
                document.getElementById('totalEarned').textContent = this.userData.total_earned;
                
                // 更新每日领取状态
                const today = new Date().toISOString().split('T')[0];
                const dailyStatus = document.getElementById('dailyStatus');
                
                if (this.userData.last_daily_claim === today) {
                    document.getElementById('claimDailyBtn').disabled = true;
                    document.getElementById('claimDailyBtn').innerHTML = '<i class="fas fa-check"></i> 今日已领取';
                    dailyStatus.textContent = '已完成';
                    dailyStatus.className = 'method-status status-completed';
                } else {
                    document.getElementById('claimDailyBtn').disabled = false;
                    document.getElementById('claimDailyBtn').innerHTML = '<i class="fas fa-gift"></i> 领取每日S币';
                    dailyStatus.textContent = '可领取';
                    dailyStatus.className = 'method-status status-available';
                }
                
                // 更新连续登录状态
                const streakStatus = document.getElementById('streakStatus');
                if (this.userData.login_streak >= 6) {
                    streakStatus.textContent = '即将完成';
                    streakStatus.style.background = 'var(--gold-color)';
                } else {
                    streakStatus.textContent = '进行中';
                    streakStatus.style.background = 'var(--secondary-color)';
                }
            },
            
            updateTransactionsDisplay(transactions) {
                const container = document.getElementById('transactionsList');
                
                if (transactions.length === 0) {
                    container.innerHTML = `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-type">暂无交易记录</div>
                                <div class="transaction-date">完成任务来赚取S币吧！</div>
                            </div>
                            <div class="transaction-amount amount-positive">0 S币</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = transactions.map(transaction => `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-type">${transaction.description}</div>
                            <div class="transaction-date">${new Date(transaction.created_at).toLocaleString()}</div>
                        </div>
                        <div class="transaction-amount ${transaction.amount > 0 ? 'amount-positive' : 'amount-negative'}">
                            ${transaction.amount > 0 ? '+' : ''}${transaction.amount} S币
                        </div>
                    </div>
                `).join('');
            },
            
            updateLeaderboardDisplay(leaderboard) {
                const container = document.getElementById('leaderboardList');
                
                if (leaderboard.length === 0) {
                    container.innerHTML = `
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank">1</div>
                            <div class="leaderboard-user">
                                <div class="leaderboard-avatar">?</div>
                                <div class="leaderboard-name">暂无数据</div>
                            </div>
                            <div class="leaderboard-score">0 S币</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = leaderboard.map((user, index) => `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank ${index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : ''}">
                            ${index + 1}
                        </div>
                        <div class="leaderboard-user">
                            <div class="leaderboard-avatar">${user.username.charAt(0).toUpperCase()}</div>
                            <div class="leaderboard-name">${user.username}</div>
                        </div>
                        <div class="leaderboard-score">${user.balance} S币</div>
                    </div>
                `).join('');
                
                // 更新用户排名
                if (this.currentUser) {
                    const userIndex = leaderboard.findIndex(user => user.username === this.currentUser.username);
                    document.getElementById('userRank').textContent = userIndex !== -1 ? `#${userIndex + 1}` : '未上榜';
                }
            },
            
            getAvatarColor(username) {
                const colors = [
                    '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                    '#9b59b6', '#1abc9c', '#d35400', '#c0392b'
                ];
                let hash = 0;
                for (let i = 0; i < username.length; i++) {
                    hash = username.charCodeAt(i) + ((hash << 5) - hash);
                }
                return colors[Math.abs(hash) % colors.length];
            },
            
            bindEvents() {
                document.getElementById('claimDailyBtn').addEventListener('click', () => {
                    this.claimDailyScoin();
                });
                
                document.getElementById('refreshBtn').addEventListener('click', async () => {
                    document.getElementById('refreshBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> 刷新中...';
                    await this.loadUserData();
                    await this.loadTransactions();
                    await this.loadLeaderboard();
                    setTimeout(() => {
                        document.getElementById('refreshBtn').innerHTML = '<i class="fas fa-sync-alt"></i> 刷新数据';
                        this.showNotification('数据已刷新');
                    }, 500);
                });
                
                document.getElementById('logoutBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    const { error } = await supabase.auth.signOut();
                    if (error) {
                        this.showNotification('退出登录失败', true);
                    }
                });
            },
            
            showNotification(message, isError = false) {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');
                
                notificationText.textContent = message;
                
                if (isError) {
                    notification.style.borderLeftColor = 'var(--accent-color)';
                } else {
                    notification.style.borderLeftColor = 'var(--scoin-color)';
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            const startTime = performance.now();
            
            Promise.all([
                initLoader(),
                initThemeToggle(),
                ScoinSystem.init()
            ]).then(() => {
                const loadTime = performance.now() - startTime;
                document.getElementById('loadTime').textContent = Math.round(loadTime);
            }).catch(error => {
                console.error('初始化过程中出错:', error);
                ScoinSystem.showNotification('系统初始化失败', true);
            });
        });

        // 初始化加载器
        function initLoader() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const loader = document.getElementById('loader');
                    if (loader) {
                        loader.classList.add('hidden');
                    }
                    resolve();
                }, 500);
            });
        }

        // 初始化主题切换
        function initThemeToggle() {
            return new Promise((resolve) => {
                const themeToggle = document.getElementById('themeToggle');
                if (!themeToggle) {
                    resolve();
                    return;
                }
                
                if (localStorage.getItem('theme') === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
                
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    if (currentTheme === 'dark') {
                        document.documentElement.removeAttribute('data-theme');
                        localStorage.setItem('theme', 'light');
                        this.innerHTML = '<i class="fas fa-moon"></i>';
                    } else {
                        document.documentElement.setAttribute('data-theme', 'dark');
                        localStorage.setItem('theme', 'dark');
                        this.innerHTML = '<i class="fas fa-sun"></i>';
                    }
                });
                
                resolve();
            });
        }
    </script>
</body>
</html>